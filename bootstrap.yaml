- name: Initialize
  hosts: all
  become: true
  tags:
    - update
    - docker
  roles:
    - update
    - docker

- name: Setup Pi-Hole
  hosts: piholes
  become: true
  tags:
    - pihole
  pre_tasks:
    - name: Load configuration
      ansible.builtin.include_vars: "{{ item }}"
      loop:
        - config/general.yaml
        - config/pihole.yaml
        - config/domain.yaml
  roles:
    - pihole

- name: Setup PKI
  hosts: pkis
  become: true
  tags:
    - pki
  pre_tasks:
    - name: Load configuration
      ansible.builtin.include_vars: "{{ item }}"
      loop:
        - config/general.yaml
        - config/pki.yaml
  roles:
    - role: yubihsm
      tags:
        - hsm
    - role: pki
